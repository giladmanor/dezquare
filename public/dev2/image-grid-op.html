<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<title>Dezquare</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="description" content="" />
	<link href="css/fonts/fonts.css" rel="stylesheet" type="text/css" media="screen" />
	<link href="css/main.css" rel="stylesheet" type="text/css" media="screen" />
	<link href="css/responsive.css" rel="stylesheet" type="text/css" media="screen" />
	<script type="text/javascript" src="js/jquery-1.9.0.min.js"></script>
	<script type="text/javascript" src="js/global.js"></script>
	<script type="text/javascript" src="js/game-persona.js"></script>
</head>
<body>
	<section id="page">
		
		<section id="image-grid">
			
			<article class="image-item item-w2-h1">
				<a href="#">
					<img src="img/temp/grid/1.jpg" />
				</a>
			</article>
			<article class="image-item item-w2-h2">
				<a href="#">
					<img src="img/temp/grid/2.jpg" />
				</a>
			</article>
			<article class="image-item item-w2-h1">
				<a href="#">
					<img src="img/temp/grid/3.jpg" />
				</a>
			</article>
			<article class="image-item item-w2-h1">
				<a href="#">
					<img src="img/temp/grid/4.jpg" />
				</a>
			</article>
			<article class="image-item item-w2-h1">
				<a href="#">
					<img src="img/temp/grid/5.jpg" />
				</a>
			</article>
			<article class="image-item item-w2-h2">
				<a href="#">
					<img src="img/temp/grid/6.jpg" />
				</a>
			</article>
			<article class="image-item item-w2-h1">
				<a href="#">
					<img src="img/temp/grid/7.jpg" />
				</a>
			</article>
			<article class="image-item item-w2-h1">
				<a href="#">
					<img src="img/temp/grid/8.jpg" />
				</a>
			</article>
			<article class="image-item item-w2-h2">
				<a href="#">
					<img src="img/temp/grid/9.jpg" />
				</a>
			</article>
			<article class="image-item item-w3-h2">
				<a href="#">
					<img src="img/temp/grid/10.jpg" />
				</a>
			</article>
			<article class="image-item item-w2-h1">
				<a href="#">
					<img src="img/temp/grid/11.jpg" />
				</a>
			</article>
			<article class="image-item item-w3-h2">
				<a href="#">
					<img src="img/temp/grid/12.jpg" />
				</a>
			</article>
			<article class="image-item item-w1-h1">
				<a href="#">
					<img src="img/temp/grid/13.jpg" />
				</a>
			</article>
			<article class="image-item item-w2-h2">
				<a href="#">
					<img src="img/temp/grid/14.jpg" />
				</a>
			</article>
			<article class="image-item item-w2-h1">
				<a href="#">
					<img src="img/temp/grid/15.jpg" />
				</a>
			</article>
			
		</section>
		
	</section>
	
	<script type="text/javascript">
		var s = 150;
		var m = 5;
		var imageGridHolder;
		var gridElements = new Array();
		var childrenSelector = ".image-item";
		var minX = 0;
	
		$(document).ready(function(){
			imageGridHolder = $("#image-grid");
			var i = imageGridHolder.children(childrenSelector);
			ArrangeItemsInParent(imageGridHolder, i);
			
			$(window).keyup(function(e){
				//alert(e.keyCode);
				if (e.keyCode == 32)
				{
					GetNewItems();
				}
			});
		});
		
		function GetNewItems()
		{
			$.ajax({
				"url": "image-grid-ajax.html",
				"success": function(html) {
					var i = $(html).children(childrenSelector);
					ArrangeItemsInParent(imageGridHolder, i);
				}
			});
		}
		
		function ArrangeItemsInParent(parent, i)
		{
			var items = i.clone();
			i.remove();
			
			items.each(function(){
				var it = $(this);
				var p = GetFreePositionInGrid();
				it.css({
					"position": "absolute",
					"left": p.left,
					"top": p.top
				});
				imageGridHolder.append(it);
				AdjustGridHolderWidth(p, it);
			});
		}
		
		function GetFreePositionInGrid()
		{
			var finish = false;
			var x = minX;
			var y = 0;
			
			while (!finish)
			{
				for (var y=0; y < imageGridHolder.height(); y+=(s+m))
				{
					var items = imageGridHolder.children(childrenSelector);
					var isEmptyPosition = true;
					
					for (var i=0; i<items.length; i++)
					{
						var item = items.eq(i);
						var itemPosition = item.position();
						
						if (IntersectionExists(x, y, itemPosition.left, itemPosition.top, item.width(), item.height()))
						{
							isEmptyPosition = false;
						}
					}
					
					if (isEmptyPosition)
					{
						finish = true;
						break;
					}
				}
				
				if (!finish)
				{
					x += (s+m);
				}
			}
			
			return { "left": x, "top": y };
		}
		
		function IntersectionExists(x1, y1, x2, y2, w2, h2)
		{
			return ( x1 >= x2 && x1 <= (x2 + w2) && y1 >= y2 && y1 <= (y2 + h2) );
		}
		
		function AdjustGridHolderWidth(lastItemPosition, lastItem)
		{
			if (imageGridHolder.width() < lastItemPosition.left + lastItem.width())
			{
				imageGridHolder.width(lastItemPosition.left + lastItem.width());
			}
		}
	</script>
	
	<style type="text/css">
		#page { width: auto; } 
		#image-grid {
			background: red;
			width: 1400px;
			height: 600px;
		}
		.image-item {
			height: 150px;
			width: 150px;
		}
		.image-item img { 
			display: block;
			height: 100%;
			width: 100%;
		}
		
		.item-w1-h1 { width: 150px; height: 150px; }
		.item-w2-h1 { width: 305px; height: 150px; }
		.item-w2-h2 { width: 305px; height: 305px; }
		.item-w3-h2 { width: 460px; height: 305px; }
		
	</style>
</body>
</html>